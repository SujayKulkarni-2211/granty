{% extends "base.html" %}

{% block title %}Welcome to grantY - AI-Powered Grant Writing Assistant{% endblock %}

{% block styles %}
<style>
    /* Preloader - FIXED CENTERING */
    .preloader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
        z-index: 9999;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
    }

    .preloader.fade-out {
        opacity: 0;
        visibility: hidden;
    }

    .loader-content {
        text-align: center;
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    .loader-title {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        color: white;
        font-weight: 700;
    }

    .loader-subtitle {
        font-size: 1.2rem;
        margin-bottom: 2rem;
        opacity: 0.8;
    }

    .document-loader {
        width: 120px;
        height: 160px;
        background-color: #fff;
        border-radius: 8px;
        position: relative;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        overflow: hidden;
        margin: 0 auto 30px;
    }

    .document-loader::before {
        content: '';
        position: absolute;
        width: 100%;
        height: 20px;
        background: var(--primary);
        top: 0;
        left: 0;
    }

    .document-loader::after {
        content: '';
        position: absolute;
        width: 0%;
        height: 4px;
        background: var(--accent);
        bottom: 0;
        left: 0;
        animation: writing 3s linear infinite;
    }

    .document-line {
        position: absolute;
        height: 3px;
        background-color: #e0e0e0;
        left: 10px;
        right: 10px;
        border-radius: 3px;
    }

    .document-line:nth-child(1) { top: 30px; width: 80%; }
    .document-line:nth-child(2) { top: 45px; width: 90%; }
    .document-line:nth-child(3) { top: 60px; width: 70%; }
    .document-line:nth-child(4) { top: 75px; width: 85%; }
    .document-line:nth-child(5) { top: 90px; width: 60%; }
    .document-line:nth-child(6) { top: 105px; width: 75%; }
    .document-line:nth-child(7) { top: 120px; width: 65%; }
    .document-line:nth-child(8) { top: 135px; width: 40%; }

    .typing-cursor {
        position: absolute;
        width: 10px;
        height: 20px;
        background-color: var(--primary);
        bottom: 10px;
        left: 10px;
        animation: typing 3s linear infinite;
    }

    @keyframes typing {
        0% { left: 10px; }
        25% { left: 90px; }
        50% { left: 40px; }
        75% { left: 100px; }
        100% { left: 10px; }
    }

    @keyframes writing {
        0% { width: 0%; }
        50% { width: 100%; }
        100% { width: 0%; }
    }

    .loader-progress {
        width: 200px;
        height: 6px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 3px;
        margin-top: 20px;
        overflow: hidden;
    }

    .loader-progress-bar {
        height: 100%;
        width: 0;
        background: var(--accent);
        border-radius: 3px;
        transition: width 0.5s ease;
    }

    /* Hero Section */
    .hero-section {
        text-align: center;
        padding: 60px 0;
        margin-bottom: 40px;
    }

    .hero-title {
        font-size: 3.5rem;
        font-weight: 700;
        margin-bottom: 20px;
        color: white;
        line-height: 1.2;
    }

    .hero-title span {
        color: var(--accent);
        position: relative;
    }

    .hero-title span::after {
        content: '';
        position: absolute;
        width: 100%;
        height: 4px;
        bottom: -4px;
        left: 0;
        background: linear-gradient(90deg, var(--accent), transparent);
    }

    .hero-subtitle {
        font-size: 1.3rem;
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 30px;
        line-height: 1.6;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
    }

    .typewriter-container {
        height: 40px;
        margin-bottom: 40px;
        overflow: hidden;
    }

    .typewriter-text {
        color: var(--accent);
        font-size: 1.3rem;
        font-weight: 500;
        display: inline-block;
        position: relative;
    }

    .typewriter-text::after {
        content: '|';
        position: absolute;
        right: -8px;
        animation: blink 0.7s infinite;
    }

    @keyframes blink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0; }
    }

    .hero-buttons {
        display: flex;
        gap: 20px;
        justify-content: center;
        flex-wrap: wrap;
    }

    /* Section Cards */
    .section-card {
        margin-bottom: 40px;
    }

    .section-card h2 {
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 30px;
        position: relative;
        padding-bottom: 15px;
    }

    .section-card h2::after {
        content: '';
        position: absolute;
        width: 60px;
        height: 3px;
        background: linear-gradient(90deg, var(--primary), var(--accent));
        bottom: 0;
        left: 0;
    }

    /* Draft Cards */
    .draft-card {
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(10px);
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 15px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        text-decoration: none;
        display: block;
        color: inherit;
    }

    .draft-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        border-color: rgba(76, 201, 240, 0.3);
        text-decoration: none;
        color: inherit;
    }

    .draft-card h5 {
        color: white;
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 10px;
    }

    .draft-card p {
        color: rgba(255, 255, 255, 0.7);
        margin-bottom: 5px;
    }

    .draft-card small {
        color: rgba(255, 255, 255, 0.5);
    }

    .draft-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 15px;
    }

    .draft-date {
        color: var(--accent);
        font-weight: 500;
    }

    /* Template Cards */
    .template-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 30px;
        margin-top: 30px;
    }

    .template-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        transition: all 0.5s ease;
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        overflow: hidden;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .template-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(76, 201, 240, 0.1));
        opacity: 0;
        transition: all 0.5s ease;
        z-index: -1;
    }

    .template-card:hover {
        transform: translateY(-10px) scale(1.02);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        border-color: rgba(76, 201, 240, 0.3);
    }

    .template-card:hover::before {
        opacity: 1;
    }

    .template-card h5 {
        color: white;
        font-size: 1.4rem;
        font-weight: 600;
        margin-bottom: 15px;
    }

    .template-card p {
        color: rgba(255, 255, 255, 0.7);
        line-height: 1.6;
        margin-bottom: 15px;
        flex-grow: 1;
    }

    .template-card small {
        color: rgba(255, 255, 255, 0.5);
        margin-bottom: 20px;
        display: block;
    }

    .template-card form {
        margin-top: auto;
    }

    /* No Content Messages */
    .no-content {
        text-align: center;
        padding: 60px 40px;
        color: rgba(255, 255, 255, 0.6);
    }

    .no-content i {
        font-size: 4rem;
        color: rgba(76, 201, 240, 0.3);
        margin-bottom: 20px;
    }

    .no-content p {
        font-size: 1.2rem;
        margin-bottom: 20px;
    }

    .no-content a {
        color: var(--accent);
        text-decoration: none;
        font-weight: 500;
        font-size: 1.1rem;
    }

    .no-content a:hover {
        text-decoration: underline;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .hero-title {
            font-size: 2.5rem;
        }
        
        .hero-subtitle {
            font-size: 1.1rem;
        }
        
        .hero-buttons {
            flex-direction: column;
            align-items: center;
        }
        
        .hero-buttons .btn {
            width: 100%;
            max-width: 300px;
        }
        
        .template-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Preloader -->
<div class="preloader" id="preloader">
    <div class="loader-content">
        <h2 class="loader-title">grant<span style="color: var(--accent);">Y</span></h2>
        <p class="loader-subtitle">Launching your grant writing universe...</p>
        <div class="document-loader">
            <div class="document-line"></div>
            <div class="document-line"></div>
            <div class="document-line"></div>
            <div class="document-line"></div>
            <div class="document-line"></div>
            <div class="document-line"></div>
            <div class="document-line"></div>
            <div class="document-line"></div>
            <div class="typing-cursor"></div>
        </div>
        <div class="loader-progress">
            <div class="loader-progress-bar" id="progress-bar"></div>
        </div>
    </div>
</div>

<!-- Hero Section -->
<div class="hero-section">
    <h1 class="hero-title">Welcome to <span>grant</span>Y</h1>
    <p class="hero-subtitle">Create professional grant proposals with AI-powered assistance. Discover funding opportunities, write compelling applications, and collaborate with peers.</p>
    <div class="typewriter-container">
        <span class="typewriter-text" id="typewriter"></span>
    </div>
    <div class="hero-buttons">
        <a class="btn btn-primary btn-lg" href="/new-grant" role="button">
            <i class="fas fa-plus"></i> Create New Grant
        </a>
        <a class="btn btn-outline-primary btn-lg" href="/templates" role="button">
            <i class="fas fa-layer-group"></i> Browse Templates
        </a>
    </div>
</div>

<!-- Your Drafts Section -->
<div class="card section-card">
    <div class="card-header">
        <h2><i class="fas fa-file-alt"></i> Your Drafts</h2>
    </div>
    <div class="card-body">
        {% if drafts %}
            <div class="drafts-container">
                {% for draft in drafts %}
                    <a href="/editor/{{ draft.id }}" class="draft-card">
                        <h5>{{ draft.title }}</h5>
                        <p><i class="fas fa-bookmark"></i> Template: {{ draft.template_id }}</p>
                        <p><i class="fas fa-list"></i> Sections: {{ draft.sections|length }}</p>
                        <div class="draft-meta">
                            <small class="draft-date">
                                <i class="fas fa-clock"></i> {{ draft.updated_at }}
                            </small>
                        </div>
                    </a>
                {% endfor %}
            </div>
        {% else %}
            <div class="no-content">
                <i class="fas fa-file-plus"></i>
                <p>No drafts yet.</p>
                <a href="/new-grant">Create your first grant proposal</a>
            </div>
        {% endif %}
    </div>
</div>

<!-- Available Templates Section -->
<div class="card section-card">
    <div class="card-header">
        <h2><i class="fas fa-layer-group"></i> Available Templates</h2>
    </div>
    <div class="card-body">
        {% if templates %}
            <div class="template-grid">
                {% for template in templates %}
                    <div class="template-card">
                        <h5>{{ template.name }}</h5>
                        <p>{{ template.description }}</p>
                        <small><i class="fas fa-puzzle-piece"></i> {{ template.sections|length }} sections</small>
                        <form action="/new-grant" method="post">
                            <input type="hidden" name="template_id" value="{{ template.id }}">
                            <button type="submit" class="btn btn-outline-primary w-100">
                                <i class="fas fa-rocket"></i> Use Template
                            </button>
                        </form>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="no-content">
                <i class="fas fa-layer-group"></i>
                <p>No templates available yet.</p>
                <a href="/new-grant">Create a custom grant</a>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Preloader - FIXED CENTERING
document.addEventListener('DOMContentLoaded', function() {
    const preloader = document.getElementById('preloader');
    const progressBar = document.getElementById('progress-bar');
    let progress = 0;
    
    const interval = setInterval(() => {
        progress += Math.random() * 10;
        if (progress > 100) progress = 100;
        progressBar.style.width = progress + '%';
        
        if (progress === 100) {
            clearInterval(interval);
            setTimeout(() => {
                preloader.classList.add('fade-out');
                setTimeout(() => {
                    preloader.style.display = 'none';
                }, 500);
            }, 500);
        }
    }, 200);
});

// Typewriter Effect
function typeWriter() {
    const typewriterElement = document.getElementById('typewriter');
    const phrases = [
        "Discover the perfect grants for your research...",
        "Write compelling proposals in half the time...",
        "Connect with collaborators worldwide...",
        "Secure funding with AI-powered assistance..."
    ];
    
    let phraseIndex = 0;
    let charIndex = 0;
    let isDeleting = false;
    let typingSpeed = 100;
    
    function type() {
        const currentPhrase = phrases[phraseIndex];
        
        if (isDeleting) {
            typewriterElement.textContent = currentPhrase.substring(0, charIndex - 1);
            charIndex--;
            typingSpeed = 50;
        } else {
            typewriterElement.textContent = currentPhrase.substring(0, charIndex + 1);
            charIndex++;
            typingSpeed = 100;
        }
        
        if (!isDeleting && charIndex === currentPhrase.length) {
            isDeleting = true;
            typingSpeed = 1500; // Pause at the end
        } else if (isDeleting && charIndex === 0) {
            isDeleting = false;
            phraseIndex = (phraseIndex + 1) % phrases.length;
            typingSpeed = 500; // Pause before starting new phrase
        }
        
        setTimeout(type, typingSpeed);
    }
    
    type();
}

// Start typewriter effect
typeWriter();

// Add animation to cards on scroll
const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
        }
    });
}, { threshold: 0.1 });

// Observe all cards
document.querySelectorAll('.draft-card, .template-card, .section-card').forEach(card => {
    card.style.opacity = '0';
    card.style.transform = 'translateY(20px)';
    card.style.transition = 'all 0.6s ease';
    observer.observe(card);
});
</script>
{% endblock %}